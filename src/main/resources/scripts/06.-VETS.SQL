-- TABLE
CREATE TABLE VETS (
  ID                  INT PRIMARY KEY,
  FIRST_NAME          VARCHAR2(30),
  LAST_NAME           VARCHAR(30),
  PROFILE_DESCRIPTION VARCHAR(255)
);

CREATE INDEX VETS_LAST_NAME ON VETS (LAST_NAME);

CREATE TABLE VET_SPECIALTIES (
  VET_ID       INTEGER NOT NULL,
  SPECIALTY_ID INTEGER NOT NULL
);

ALTER TABLE VET_SPECIALTIES ADD CONSTRAINT FK_VET_SPECIALTIES_VETS FOREIGN KEY (VET_ID) REFERENCES VETS (ID);
ALTER TABLE VET_SPECIALTIES ADD CONSTRAINT FK_VET_SPECIALTIES_SPECIALTIES FOREIGN KEY (SPECIALTY_ID) REFERENCES SPECIALTIES (ID);

-- INSERTS
INSERT INTO VETS
VALUES (1, 'James', 'Carter', NULL);
INSERT INTO VETS
VALUES (2, 'Helen', 'Leary', NULL);
INSERT INTO VETS
VALUES (3, 'Linda', 'Douglas', NULL);
INSERT INTO VETS
VALUES (4, 'Rafael', 'Ortega', NULL);
INSERT INTO VETS
VALUES (5, 'Henry', 'Stevens', NULL);
INSERT INTO VETS
VALUES (6, 'Sharon', 'Jenkins', NULL);

INSERT INTO VET_SPECIALTIES
VALUES (2, 1);
INSERT INTO VET_SPECIALTIES
VALUES (3, 2);
INSERT INTO VET_SPECIALTIES
VALUES (3, 3);
INSERT INTO VET_SPECIALTIES
VALUES (4, 2);
INSERT INTO VET_SPECIALTIES
VALUES (5, 1);

-- PACKAGE HEADER
CREATE OR REPLACE PACKAGE PKG_VETS
  AS
  TYPE C_CURSOR IS REF CURSOR;

  PROCEDURE SP_FIND_ALL(P_CURSOR OUT C_CURSOR);

END PKG_VETS;

-- PACKAGE BODY
CREATE OR REPLACE PACKAGE BODY PKG_VETS
  AS

  PROCEDURE SP_FIND_ALL(P_CURSOR OUT C_CURSOR)
    AS
    BEGIN
      OPEN P_CURSOR
      FOR
      SELECT ID,
             FIRST_NAME,
             LAST_NAME,
             PROFILE_DESCRIPTION
        FROM VETS
        ORDER BY LAST_NAME,
                 FIRST_NAME;
    END SP_FIND_ALL;

END PKG_VETS;

/*
-- FIND ALL QUERY
SELECT DISTINCT V.ID,
                V.PROFILE_DESCRIPTION,
                V.FIRST_NAME,
                V.LAST_NAME,
                S.ID,
                S.NAME
  FROM VETS V
    LEFT OUTER JOIN VET_SPECIALTIES VS
      ON VS.VET_ID = V.ID
    JOIN SPECIALTIES S
      ON S.ID = VS.SPECIALTY_ID
  ORDER BY V.LAST_NAME,
           V.FIRST_NAME;


-- FIND ALL QUERY BY JPA
SELECT DISTINCT t1.id, 
                t1.profile_description, 
                t1.first_name, 
                t1.last_name, 
                t0.id, 
                t0.name 
FROM vets t1 
  LEFT OUTER JOIN 
    (vet_specialties t2 JOIN specialties t0 ON (t0.id = t2.specialty_id)) 
  ON (t2.vet_id = t1.id) 
ORDER BY t1.last_name, t1.first_name;
*/
